# Implementation Plan

- [x] 1. Set up infrastructure and dependencies
  - [x] 1.1 Install required dependencies (ky, zod, zustand, fast-check)
    - Run: `bun add ky zod zustand`
    - Run: `bun add -D fast-check`
    - _Requirements: 5.1, 5.2_
  - [x] 1.2 Install shadcn form and input components
    - Run: `bunx shadcn@latest add form input button card label`
    - _Requirements: 6.1_
  - [x] 1.3 Create Ky HTTP client instance at `src/shared/infrastructure/http.ts`
    - Configure prefixUrl from `BACKEND_URL` environment variable
    - Add error handling hooks to extract API error messages
    - _Requirements: 5.1, 5.2, 5.3_
  - [ ]* 1.4 Write property test for API error extraction
    - **Property 6: API error messages are extracted correctly**
    - **Validates: Requirements 5.3**

- [-] 2. Implement auth module types and schemas
  - [x] 2.1 Create Zod schemas at `src/modules/auth/types/schemas.ts`
    - Define signupSchema (name, email, password min 6)
    - Define signinSchema (email, password)
    - Define tokensResponseSchema (access, refresh)
    - Define errorResponseSchema (message, issues)
    - Export inferred TypeScript types
    - _Requirements: 4.1, 4.2_
  - [ ]* 2.2 Write property tests for schema validation
    - **Property 1: Valid signup credentials pass validation**
    - **Property 2: Invalid email format fails validation**
    - **Property 3: Short passwords fail validation**
    - **Validates: Requirements 1.1, 1.3, 1.4**
  - [ ]* 2.3 Write property test for token response round-trip
    - **Property 7: Token response round-trip validation**
    - **Validates: Requirements 4.2, 5.5**

- [x] 3. Implement auth service layer
  - [x] 3.1 Create auth service at `src/modules/auth/services/auth-service.ts`
    - Implement signup function calling POST /auth/signup
    - Implement signin function calling POST /auth/signin
    - Implement signout function calling POST /auth/signout
    - Implement refresh function calling POST /auth/refresh
    - Validate responses with Zod schemas
    - _Requirements: 1.1, 2.1, 5.2, 5.4, 5.5_

- [x] 4. Implement auth store
  - [x] 4.1 Create Zustand store at `src/modules/auth/store/use-auth-store.ts`
    - Define isAuthenticated state
    - Implement setAuthenticated action
    - Implement clearAuth action
    - _Requirements: 7.1, 7.2, 7.3_
  - [ ]* 4.2 Write property tests for auth store
    - **Property 8: Auth store updates on signin**
    - **Property 9: Auth store clears on signout**
    - **Validates: Requirements 7.1, 7.2**

- [x] 5. Implement server actions
  - [x] 5.1 Create signup action at `src/modules/auth/actions/signup-action.ts`
    - Validate form data with Zod schema
    - Call auth service signup
    - Set JWT cookies on success
    - Return ActionResult with errors or success
    - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 4.1, 4.3_
  - [x] 5.2 Create signin action at `src/modules/auth/actions/signin-action.ts`
    - Validate form data with Zod schema
    - Call auth service signin
    - Set JWT cookies on success
    - Return ActionResult with errors or success
    - _Requirements: 2.1, 2.2, 4.1, 4.3_
  - [x] 5.3 Create signout action at `src/modules/auth/actions/signout-action.ts`
    - Get refresh token from cookies
    - Call auth service signout
    - Delete JWT cookies
    - Redirect to signin page
    - _Requirements: 7.2_

- [x] 6. Implement auth form components
  - [x] 6.1 Create signup form at `src/modules/auth/components/signup-form.tsx`
    - Use Shadcn Form with react-hook-form
    - Integrate Zod schema validation
    - Display inline validation errors
    - Handle form submission with server action
    - Show API error messages
    - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 6.1, 6.4_
  - [x] 6.2 Create signin form at `src/modules/auth/components/signin-form.tsx`
    - Use Shadcn Form with react-hook-form
    - Integrate Zod schema validation
    - Auto-focus email input on mount
    - Display inline validation errors
    - Handle form submission with server action
    - Show API error messages
    - _Requirements: 2.1, 2.2, 2.4, 6.1, 6.4_

- [x] 7. Implement auth pages
  - [x] 7.1 Create auth layout at `src/app/(auth)/layout.tsx`
    - Centered card layout for auth forms
    - Mobile-first responsive design
    - _Requirements: 6.1_
  - [x] 7.2 Create signup page at `src/app/(auth)/signup/page.tsx`
    - Server component rendering SignupForm
    - Link to signin page
    - _Requirements: 1.6_
  - [x] 7.3 Create signin page at `src/app/(auth)/signin/page.tsx`
    - Server component rendering SigninForm
    - Link to signup page
    - _Requirements: 2.3_

- [x] 8. Implement middleware for route protection
  - [x] 8.1 Create middleware at `src/middleware.ts`
    - Check for JWT cookie presence
    - Redirect unauthenticated users from protected routes to signin
    - Redirect authenticated users from auth pages to dashboard
    - Configure route matcher
    - _Requirements: 3.1, 3.2, 3.3_
  - [ ]* 8.2 Write property tests for middleware redirect logic
    - **Property 4: Unauthenticated users are redirected from protected routes**
    - **Property 5: Authenticated users are redirected from auth pages**
    - **Validates: Requirements 3.1, 3.2**

- [x] 9. Create placeholder dashboard page
  - [x] 9.1 Create dashboard page at `src/app/dashboard/page.tsx`
    - Simple server component with welcome message
    - Signout button
    - _Requirements: 1.6, 2.3_

- [ ] 10. Final Checkpoint
  - Ensure all tests pass, ask the user if questions arise.
